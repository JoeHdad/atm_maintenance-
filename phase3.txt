### **PHASE 3: TECHNICIAN FEATURES**

#### **Feature 3.1: Device List View (Backend)**
**Purpose**: API endpoint for technician to fetch their assigned devices.

**AI Agent Prompt**:
```
Refer to /instructions/api-endpoints.md and /instructions/database-schema.md.

Create backend endpoint for technician to view their assigned devices.

Requirements:
1. Endpoint: GET /api/technician/devices
2. Permission: IsTechnician only
3. Filters (query params):
   - type (Cleaning / Electrical / All)
   - status (from Device.status field)
4. Logic:
   - Fetch devices linked to authenticated technician via TechnicianDevice
   - Filter by technician's city
   - Return only devices matching filters
5. Output for each device:
   - All device fields
   - Submission status (check if already submitted for current half_month)
   - Next due date calculation:
     * Cleaning: show which half_month is next (1 or 2)
     * Electrical: show next month if already submitted this month
6. Order by: gfm_problem_date DESC

⚠️ Do NOT add submission logic here.
⚠️ Do NOT modify Device model.
Only device list retrieval with filters.

Output: views.py, serializers.py, urls.py
```

---

#### **Feature 3.2: Device List View (Frontend)**
**Purpose**: UI for technician to view and filter their assigned devices.

**AI Agent Prompt**:
```
Refer to /instructions/best-practices.md.

Create React component for technician device list.

Requirements:
1. Create DeviceList component:
   - Filter dropdowns: Type (All/Cleaning/Electrical), Status
   - Device cards/table showing:
     * Interaction ID
     * GFM Cost Center
     * Status (Region)
     * Type badge (Cleaning/Electrical)
     * Next Due Date
     * Button: "View Details"
2. Click on device → navigate to device detail page
3. Show loading state while fetching
4. Show empty state if no devices

Styling: Card-based layout or table, responsive design

⚠️ Do NOT add photo upload UI here.
⚠️ Do NOT create device detail page yet.
Only device list with filters.

Output: DeviceList.jsx, api/technician.js
```

---

#### **Feature 3.3: Device Detail & Photo Upload (Backend)**
**Purpose**: API endpoint for technician to submit visit with photos.

**AI Agent Prompt**:
```
Refer to /instructions/database-schema.md and /instructions/security-guidelines.md.

Create backend endpoint for technician to submit visit with photos.

Requirements:
1. Endpoint: POST /api/technician/submit
2. Permission: IsTechnician only
3. Input (multipart/form-data):
   - device_id
   - visit_date (today)
   - half_month (1 or 2, auto-calculated from visit_date)
   - 8 photo files (section1_1, section1_2, section1_3, section2_1, section2_2, section2_3, section3_1, section3_2)
   - job_description (dropdown value)
   - status (Ok / Not Ok)
   - remarks (optional text)
4. Validation:
   - Check device belongs to technician
   - Check duplicate submission (same device + same half_month)
   - Validate exactly 8 photos uploaded
   - Validate photo formats (jpg, jpeg, png)
   - Validate photo size (max 10MB each)
5. Logic:
   - Create Submission record (status = Pending)
   - Save photos to /media/photos/{submission_id}/
   - Create 8 Photo records linked to submission with correct section and order_index
6. Output: Submission ID and success message

⚠️ Do NOT generate PDF here.
⚠️ Do NOT send emails here.
Only create submission and store photos.

Output: views.py, serializers.py, utils/file_handler.py
```

---

#### **Feature 3.4: Photo Upload UI (Frontend)**
**Purpose**: UI for technician to upload 8 photos and submit visit.

**AI Agent Prompt**:
```
Refer to /instructions/best-practices.md.

Create React component for technician photo upload and submission.

Requirements:
1. Create DeviceDetail component:
   - Display all device info (Interaction ID, Cost Center, Status, Problem Type, Date, City, Region)
   - Button: "Add Visit" → opens PhotoUploadModal
2. Create PhotoUploadModal component:
   - Section 1: 3 file inputs with labels ("Machine + Pylon from 3-5m")
   - Section 2: 3 file inputs with labels ("Zoom front/back from 3-5m")
   - Section 3: 2 file inputs with labels ("Asphalt + Pavement")
   - Live preview thumbnails for uploaded photos
   - Static fields form:
     * Job Description (dropdown)
     * Status (dropdown: Ok / Not Ok)
     * Remarks (textarea, optional)
   - Submit button (disabled until all 8 photos uploaded)
3. Validation:
   - Check file type (jpg, jpeg, png)
   - Check file size (max 10MB)
   - Prevent submission if less than 8 photos
4. Show progress indicator during upload
5. Success message after submission

Styling: Clean modal with clear section labels and photo previews

⚠️ Do NOT integrate with PDF generation.
⚠️ Do NOT add submission history view here.
Only photo upload and submission form.

Output: DeviceDetail.jsx, PhotoUploadModal.jsx, api/technician.js
```

---

#### **Feature 3.5: Technician Dashboard Layout**
**Purpose**: Complete Technician dashboard with navigation.

**AI Agent Prompt**:
```
Refer to /instructions/best-practices.md.

Create the complete Technician Dashboard layout.

Requirements:
1. Dashboard layout component:
   - Top navigation bar (logo, username, city badge, logout)
   - Main content area with routes:
     * /technician/devices → DeviceList
     * /technician/devices/:id → DeviceDetail
2. Add dashboard home page showing:
   - Total devices assigned
   - Pending submissions count
   - Approved submissions count
3. Integrate DeviceList component (from Feature 3.2)
4. Integrate DeviceDetail component (from Feature 3.4)

Styling: Clean, mobile-responsive layout

⚠️ Do NOT add supervisor features here.
⚠️ Do NOT modify existing components.
Only create dashboard layout and routing.

Output: TechnicianDashboard.jsx, TechnicianHome.jsx
```
